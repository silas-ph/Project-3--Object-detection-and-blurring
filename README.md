# Video Processing with YOLO and Streamlit for Privacy-Preserving Object Detection

## Table of Contents
1. [Executive Summary](#executive-summary)
2. [Introduction](#introduction)
3. [GitHub Organization](#github-organization)
4. [Technology Stack](#technology-stack)
5. [Step 1 – Creating a Custom Dataset with Roboflow](#step-1--creating-a-custom-dataset-with-roboflow)
    - [Collaboration and Quality Control](#collaboration-and-quality-control)
    - [Export Flexibility](#export-flexibility)
    - [API Integration](#api-integration)
    - [Exploratory Data Analysis (EDA)](#exploratory-data-analysis-eda)
    - [Image Annotation](#image-annotation)
    - [Split into Train, Validation, and Test Sub-Datasets](#split-into-train-validation-and-test-sub-datasets)
    - [Image Augmentation](#image-augmentation)
6. [Step 2 – YOLO Model Training](#step-2--yolo-model-training)
    - [Advantages of YOLO](#advantages-of-yolo)
    - [Model Training](#model-training)
    - [Object Detection Metrics Used](#object-detection-metrics-used)
    - [Hyperparameter Tuning](#hyperparameter-tuning)
7. [Step 3 – Streamlit Application for Video Processing](#step-3--streamlit-application-for-video-processing)
    - [Overview of the Video Processing Solution](#overview-of-the-video-processing-solution)
    - [Privacy Preservation with Gaussian Blur](#privacy-preservation-with-gaussian-blur)
    - [System Evaluation](#system-evaluation)
    - [Challenges and Solutions](#challenges-and-solutions)
    - [Future Improvements](#future-improvements)
8. [Conclusion](#conclusion)
9. [Resources](#resources)
10. [References](#references)

## Executive Summary
We trained a YOLO (You Look Only Once) AI model to successfully detect picture objects with bounding boxes in images. We applied the YOLO model to videos to detect these objects and blurred them using a Gaussian Blur algorithm. We built a web application using Streamlit, allowing users to upload their own videos for processing and download the processed video. This application is intended for users who want to de-identify objects in videos before publishing them to a (semi-)public audience.

## Introduction
This report presents a comprehensive overview of implementing a privacy-preserving object detection solution using YOLO (You Only Look Once) for model training and inference, integrated with a Streamlit application for video processing. The system detects objects in video streams and applies Gaussian blur to specific regions, ensuring privacy and security in the processed output. This project combines state-of-the-art object detection techniques with practical video processing, showcasing an end-to-end solution for a real-world application.

## GitHub Organization
This GitHub repository contains the following subfolders:
- `Docs` – Contains the presentation slide deck describing the project.
- `Images` – Contains the images used in our final model organized into “train”, “valid”, and “test” subfolders.
- `Jupyter Notebooks` – Contains two Jupyter notebooks:
  - `Project_3_model_training.ipynb` – Contains the code to train a YOLO model.
  - `RetrieveYOLOMetrics.ipynb` – Contains the code to retrieve the metrics for each valid training run.
- `Runs` – Contains a subfolder with saved data and metrics for each training run using different YOLO models and hyperparameters.
- `Streamlit` – Contains `streamlit.py` the python script for the end-user web application to process videos and `best.pt` a file generated by YOLO containing a set of its parameters.

## Technology Stack
Our application uses several key technologies:
- **Data Preparation**: Utilizing Roboflow and Kaggle for dataset creation and annotation.
- **Dataset Management**: Utilizing Roboflow to create a custom dataset.
- **Model Training**: Employing YOLO for object detection, training it on our custom dataset.
- **Video Processing**: Implementing a Streamlit application for video input and processing.
- **Privacy Preservation**: Applying Gaussian blur to detected objects for privacy.

## Step 1 – Creating a Custom Dataset with Roboflow
We used Roboflow to create custom image datasets that can be used directly to train our YOLO models. Roboflow provided several features:

### Collaboration and Quality Control
Roboflow allows multiple team members to work on the same annotation project simultaneously. Annotation is performed through a user interface, ensuring the consistency of the label files containing the annotation information.

### Export Flexibility
The label files can be exported in various formats, including those required by different YOLO versions.

### API Integration
Roboflow provides a code snippet that can be directly copied into the code used to train the YOLO models. This snippet creates the folder structure that YOLO expects, with images in `train`, `val`, and `test` folders.

### Exploratory Data Analysis (EDA)
Using a single Kaggle dataset simplified our EDA. All source images were consistently formatted as JPG images and uniformly sized to 224x224 pixels. We used Roboflow’s preprocessing functions to ensure all images were the correct size and orientation.

### Image Annotation
Image annotation involves identifying class objects in the image, assigning them to the correct class, and identifying bounding boxes around each object. Roboflow's interface enabled efficient image annotation with features such as drag-and-drop bounding boxes, keyboard shortcuts, and a smart polygon tool.

### Split into Train, Validation, and Test Sub-Datasets
YOLO expects datasets to be split into `train`, `val` (validation), and `test` sub-datasets. Roboflow's "Create Dataset" feature automates this process, creating the necessary folder structure and files expected by YOLO.

### Image Augmentation
To increase the number of training images, we used Roboflow's augmentation capabilities, applying crop, rotation, brightness, and blur augmentations.

## Step 2 – YOLO Model Training

### Advantages of YOLO
- **Speed**: Single-stage detection allows for object class detection and bounding box identification in one pass.
- **Accuracy**: YOLO architecture and advanced loss functions lead to precise localization of objects.
- **Flexibility**: Model sizes range from nano to extra-large, with varying numbers of parameters.
- **Transfer of Best Parameters**: Each run generates a `best.pt` file containing the best parameters, which can be used in subsequent runs.
- **Anchor-free Detection**: Simplifies the detection process and often improves performance on small objects.

### Model Training
We conducted 17 training runs using different YOLO versions, models, and hyperparameters. Initial runs helped optimize the dataset size, Google Colab setup, and YOLO model choice. We increased the dataset size to 8145 images through augmentation, leading to improved precision.

### Object Detection Metrics Used
We used the following metrics to evaluate each training run:
- **Precision (P)**: The proportion of true positives among all positive predictions.
- **Recall (R)**: The proportion of true positives among all actual positives.
- **mAP50**: Mean average precision at an IoU threshold of 0.50.
- **mAP50-95**: The average mean average precision at varying IoU thresholds from 0.50 to 0.95.

### Hyperparameter Tuning
We adjusted epochs, batch size, patience, and IoU threshold. The final configuration chosen for video processing was:
- **Model**: yolov10m
- **Epochs**: 600
- **Cache**: True
- **Batch Size**: -1
- **Patience**: 100
- **IoU**: 0.5

This configuration provided the highest precision, with metrics of:
- **Precision**: 0.792
- **Recall**: 0.552
- **mAP50**: 0.637
- **mAP50-95**: 0.425

## Step 3 – Streamlit Application for Video Processing

### Overview of the Video Processing Solution
This solution allows users to upload a video, detect objects within it, and blur those objects to ensure privacy. It integrates object detection using a YOLO model with a web application built using Streamlit.

To ensure privacy, the solution includes a function that applies a Gaussian blur to specific areas in the video frames. The solution also initializes a tracking system to follow objects across multiple frames, ensuring they remain blurred even as they move.

The main part of the solution processes the entire video, detecting objects every few frames to keep track of new and moving objects, and applies the blur to these detected areas. The web application interface is simple and user-friendly, guiding users through the process of uploading, processing, and downloading videos.

### Privacy Preservation with Gaussian Blur
- **Implementing Gaussian Blur**: The Gaussian blur is applied with a kernel size of 51x51, providing a strong blurring effect while maintaining the overall structure of the image.
- **Balancing Privacy and Usability**: The choice of blur intensity is crucial to ensure adequate privacy protection without rendering the video unusable. We experimented with different blur levels to find an optimal balance.

### System Evaluation
We evaluated our system on detection accuracy, processing speed, privacy effectiveness, and user experience.

### Challenges and Solutions
We faced several challenges, including achieving real-time processing, reducing false positives, ensuring temporal consistency of blurred regions, and managing memory. Solutions included frame skipping, fine-tuning

 the model, implementing a simple tracking algorithm, and batch processing video chunks.

### Future Improvements
Future improvements include implementing more sophisticated tracking algorithms, developing a system for selective blurring, optimizing for edge deployment, and adding UI elements for real-time blur control.

## Conclusion
This project demonstrated the successful integration of YOLO object detection with a Streamlit application for privacy-preserving video processing. By combining advanced deep learning techniques with practical video processing and a user-friendly interface, we created a system that effectively detects objects in video streams and applies privacy-preserving blur. This project provides valuable insights into the challenges and considerations of implementing AI-driven video analysis tools and highlights the importance of balancing video analytics with privacy protection.

## Resources
- Medium.com
- ChatGPT
- Claude

## References
[^1]: Redmon, Joseph et al. (2016). *You Only Look Once: Unified Real-Time Object Detection*. Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition (CVPR) 2016. [Link](https://arxiv.org/abs/1506.02640).
[^2]: Redmon, Joseph and Ali Farhadi (2016). *YOLO9000: Better, Faster, Stronger*. Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition (CVPR) 2017. [Link](https://arxiv.org/abs/1612.08242).
[^3]: Redmon, Joseph and Ali Farhadi (2018). *YOLOv3: An Incremental Improvement*. arXiv preprint 2018. [Link](https://arxiv.org/abs/1804.02767).
[^4]: Bochkovskiy, Alexey et al. (2020). *YOLOv4: Optimal Speed and Accuracy of Object Detection*. arXiv preprint 2020. [Link](https://arxiv.org/abs/2004.10934).
[^5]: Ultralytics (2024). *YOLOv5*. Ultralytics Inc. [Link](https://docs.ultralytics.com/models/yolov5/).
[^6]: Rajput, Vishal (2024). *YOLOv10: Object Detection King Is Back*. Medium.com. [Link](https://medium.com/aiguys/yolov10-object-detection-king-is-back-739eaaab134d).
[^7]: *Gaussian blur*. Wikipedia. [Link](https://en.wikipedia.org/wiki/Gaussian_blur).
[^8]: *Streamlit: A faster way to build and share data apps*. Snowflake Inc. [Link](https://streamlit.io/).
[^9]: Reni, Robin (2020). *House Rooms Image Dataset*. Kaggle. [Link](https://www.kaggle.com/datasets/robinreni/house-rooms-image-dataset/data).
[^10]: *Roboflow: Computer vision tools for developers and enterprises*. Roboflow.com. [Link](https://roboflow.com/).
[^11]: Ultralytics (2024). *YOLOv8*. Ultralytics Inc. [Link](https://docs.ultralytics.com/models/yolov8/).
[^12]: Ultralytics (2024). *YOLOv10*. Ultralytics Inc. [Link](https://docs.ultralytics.com/models/yolov10/).

![Training Interface](Images/Param%20runs%205.png)
![Annotated Image](Images/Robo%201.png)
![Dataset Split](Images/Robo%202.png)
![Augmented Images](Images/Robo%203.png)
![Model Metrics](Images/Training_logs%204.png)


